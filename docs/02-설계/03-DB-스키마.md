# 03. 상태 스키마 (DB 스키마 대체)

> 작성일: 2026-02-19

---

## 1. 개요

본 프로젝트는 DB를 사용하지 않으며, 모든 데이터를 React 상태(in-memory)로 관리한다. 이 문서는 DB 스키마 대신 **애플리케이션 상태의 TypeScript 인터페이스**를 정의한다.

---

## 2. 상태 인터페이스

### 2.1 최상위 상태

```typescript
interface ProjectState {
  layers: Layer[];
  boreholes: Borehole[];
  frictionAngle: FrictionAngleResult[];
  cohesion: CohesionResult[];
  deformationModulus: DeformationModulusResult[];
  subgradeReaction: SubgradeReactionResult[];
  anchorFriction: AnchorFrictionResult[];
  permeability: PermeabilityResult[];
  finalSummary: FinalSummaryResult[];
}
```

### 2.2 기초 엔티티

```typescript
interface Layer {
  id: string;
  name: string;
  order: number;
}

interface Borehole {
  id: string;
  name: string;
  measurements: Measurement[];
}

interface Measurement {
  id: string;
  depth: number;        // 심도 순서
  layerId: string;      // Layer.id 참조
  nValue: number;       // SPT N값
}
```

### 2.3 N값 산출 (파생 데이터)

```typescript
interface LayerSummary {
  layerId: string;
  layerName: string;
  count: number;             // 측정치 수
  representativeN: number;   // 대표 N값 (평균)
}
```

### 2.4 내부마찰각

```typescript
type ApplyMode = 'formula' | 'manual';

interface FrictionAngleResult {
  layerId: string;
  appliedN: number;                // 적용 N값 (직접 입력, 기본=대표N)
  dunham: number;                  // √(12N) + 15
  peck: number;                    // 0.3N + 27
  meyerhof: number | null;        // 0.25N + 32.5 (N<10이면 null)
  ohsaki: number;                  // √(20N) + 15
  roadBridge: number;              // √(15N) + 15
  average: number;                 // 평균 (소수점 절사, null 제외)
  min: number;
  max: number;
  testValue: number | null;        // 시험값
  nearbyData: number | null;       // 인근자료
  appliedValue: number;            // 최종 적용값
  applyMode: ApplyMode;
}
```

### 2.5 점착력

```typescript
interface CohesionResult {
  layerId: string;
  appliedN: number;                // 선행 적용N값
  dunham: number;                  // (N/0.077) / 2
  terzaghiPeck: number;           // (N/0.082) / 2
  ohsaki: number;                  // (40 + N/0.2) / 2
  average: number;
  min: number;
  max: number;
  testValue: number | null;
  nearbyData: number | null;
  appliedValue: number;
  applyMode: ApplyMode;
}
```

### 2.6 변형계수

```typescript
type SoilType = '점토' | '실트' | '모래' | '자갈';
type BowlesType = 1 | 2 | 3 | 4;  // 모래/점토질모래/실트질모래/자갈섞인모래

interface DeformationModulusResult {
  layerId: string;
  appliedN: number;
  soilType: SoilType | null;          // 직접 입력
  schmertmannAlpha: number | null;    // α 계수 직접 입력
  bowlesType: BowlesType | null;      // Bowles 입력치 선택
  schmertmann: number | null;         // α×N×0.1
  bowles: number | null;              // 선택 공식에 따라
  yoshinaka: number;                  // 0.678×N^0.993
  hisatake: number;                   // (5N+70)×0.1
  roadBridge: number;                 // 2.8×N
  foundationStd: number | null;      // 모래: 0.766N, 자갈: 1.2(N+6)
  average: number;                    // null 제외 평균
  min: number;
  max: number;
  testValue: number | null;
  nearbyData: number | null;
  appliedValue: number;
  applyMode: ApplyMode;
}
```

### 2.7 수평지반반력계수

```typescript
interface SubgradeReactionResult {
  layerId: string;
  appliedN: number;
  soilType: SoilType | null;      // 선행값
  cohesion: number;                // 선행 적용 점착력
  calculatedValue: number;         // Hukuoka 또는 Soletanche
  appliedValue: number;
  applyMode: ApplyMode;
}
```

### 2.8 앵커주면마찰저항

```typescript
type GroundType = '모래' | '점토' | '모래자갈' | '경암' | '연암' | '풍화암' | '파쇄대';

interface AnchorFrictionResult {
  layerId: string;
  appliedN: number;
  soilType: SoilType | null;
  groundType: GroundType;          // 지반의 종류
  calculatedValue: number;
}
```

### 2.9 투수계수

```typescript
interface PermeabilityResult {
  layerId: string;
  soilType: SoilType | null;
  d10: number | null;              // D10 (mm)
  d20: number | null;              // D20 (mm)
  hazen: number | null;            // 1.5 × D10²
  creager: number | null;          // D20 참조테이블 조회
  fieldTest: number | null;        // 현장시험값
  nearbyData: number | null;       // 인근자료
  appliedValue: number;
  applyMode: ApplyMode;
  remark: string;                  // 적용 근거 (자동)
}
```

### 2.10 최종 요약

```typescript
interface FinalSummaryResult {
  layerId: string;
  layerName: string;
  representativeN: number;
  appliedN: number;
  unitWeight: number | null;       // 단위중량 rt (kN/m³, 직접 입력)
  cohesion: number;                // 점착력 c (kPa)
  frictionAngle: number;           // 내부마찰각 φ (°)
  deformationModulus: number;      // 변형계수 E (MPa)
  subgradeReaction: number;        // 수평지반반력계수 kh (kN/m³)
  permeability: number;            // 투수계수 k (cm/sec)
}
```

---

## 3. 인덱스 및 제약조건

| 제약 | 설명 |
|------|------|
| Layer.id 유일성 | 지층 ID는 프로젝트 내에서 고유 |
| Borehole.id 유일성 | 시추공 ID는 프로젝트 내에서 고유 |
| Measurement.layerId 참조 무결성 | 존재하는 Layer.id만 참조 |
| Result.layerId 참조 무결성 | 존재하는 Layer.id만 참조 |
| Layer 삭제 시 cascade | 관련 Measurement, Result 모두 삭제 |
| Borehole 삭제 시 cascade | 해당 시추공의 Measurement 모두 삭제 |
